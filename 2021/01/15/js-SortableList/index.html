<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>JS實作- SortableList</title><meta name="description" content="Front-end Engineer"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="
成品
觀察功能需求
Drag &amp;amp; Drop API

使元素可以拖放，在 HTML5，只要為它加上 draggable=”true” 屬性，它就能「被拖曳」了


拖曳該項目時，會使下方的格子顏色變成灰色




拖曳項目到目標位置，會使了者交換
排序最後會有一個檢查順序正確與否的按鈕

JS部分1.排行榜的設置
設定熱門旅遊縣市排行榜的陣列
並宣告一個空陣列，以利後面使用

const bestPlace = [
  &amp;#39;台南&amp;#39;,
  &amp;#39;台中&amp;#39;,
  &amp;#39;高雄&amp;#39;,
  &amp;#39;台東&amp;#39;,
  &amp;#39;屏東&amp;#39;,
  &amp;#39;新北&amp;#39;,
  &amp;#39;宜蘭&amp;#39;,
  &amp;#39;花蓮&amp;#39;,
  &amp;#39;澎湖&amp;#39;,.."><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Let's Code" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Eva's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">JS實作- SortableList</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#觀察功能需求"><span class="toc-text">觀察功能需求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JS部分"><span class="toc-text">JS部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-排行榜的設置"><span class="toc-text">1.排行榜的設置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-創建排行列表，並將其呈現於頁面上"><span class="toc-text">2.創建排行列表，並將其呈現於頁面上</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-拖曳的監聽事件"><span class="toc-text">3.拖曳的監聽事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-針對監聽事件，設置各執行的函式"><span class="toc-text">4.針對監聽事件，設置各執行的函式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-交換索引，使物件交換位置swapItems"><span class="toc-text">5.交換索引，使物件交換位置swapItems</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-延續拖曳監聽事件，所要執行的其他函式"><span class="toc-text">6.延續拖曳監聽事件，所要執行的其他函式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-核對順序"><span class="toc-text">7.核對順序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#以下為補充資料："><span class="toc-text">以下為補充資料：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#拖曳補充資料："><span class="toc-text">拖曳補充資料：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使陣列隨機排序"><span class="toc-text">使陣列隨機排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#jquery-ui"><span class="toc-text">jquery ui</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#顏色"><span class="toc-text">顏色</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/JS"><i class="tag post-item-tag">JS</i></a><a href="/tags/drag&amp;drop"><i class="tag post-item-tag">drag&amp;drop</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">JS實作- SortableList</h1><time class="has-text-grey" datetime="2021-01-15T14:10:22.000Z">2021-01-15</time><article class="mt-2 post-content"><p><img src="https://i.imgur.com/K6JyjsG.png" alt=""></p>
<p><a href="https://eva813.github.io/Eva_portfolio/sortableList/sortableList.html" target="_blank" rel="noopener">成品</a></p>
<h2 id="觀察功能需求"><a href="#觀察功能需求" class="headerlink" title="觀察功能需求"></a>觀察功能需求</h2><ul>
<li><p>Drag &amp; Drop API</p>
<ul>
<li>使元素可以拖放，在 HTML5，只要為它加上 draggable=”true” 屬性，它就能「被拖曳」了</li>
</ul>
</li>
<li><p>拖曳該項目時，會使下方的格子顏色變成灰色</p>
</li>
</ul>
<p><img src="https://i.imgur.com/sZVXh9r.png" alt=""></p>
<ul>
<li>拖曳項目到目標位置，會使了者交換</li>
<li>排序最後會有一個檢查順序正確與否的按鈕</li>
</ul>
<h2 id="JS部分"><a href="#JS部分" class="headerlink" title="JS部分"></a>JS部分</h2><h3 id="1-排行榜的設置"><a href="#1-排行榜的設置" class="headerlink" title="1.排行榜的設置"></a>1.排行榜的設置</h3><ul>
<li>設定熱門旅遊縣市排行榜的陣列</li>
<li>並宣告一個空陣列，以利後面使用</li>
</ul>
<pre><code class="javascript">const bestPlace = [
  &#39;台南&#39;,
  &#39;台中&#39;,
  &#39;高雄&#39;,
  &#39;台東&#39;,
  &#39;屏東&#39;,
  &#39;新北&#39;,
  &#39;宜蘭&#39;,
  &#39;花蓮&#39;,
  &#39;澎湖&#39;,
  &#39;桃園&#39;
];


const listItems = [];</code></pre>
<h3 id="2-創建排行列表，並將其呈現於頁面上"><a href="#2-創建排行列表，並將其呈現於頁面上" class="headerlink" title="2.創建排行列表，並將其呈現於頁面上"></a>2.創建排行列表，並將其呈現於頁面上</h3><ul>
<li>宣告新的變數，並利用Fisher-Yates，創造隨機的效果<ul>
<li>注意新變數，是帶入展開運算元(把陣列中的元素取出)</li>
</ul>
</li>
<li>利用<code>each</code>跑陣列，創造變數填入<code>&lt;li&gt;</code>，並於其中填入html標籤，使畫面呈現列表。</li>
<li>jquery稱增加屬性<code>listItem.setAttribute(&#39;data-index&#39;, index);</code>,<a href="https://api.jquery.com/attr/" target="_blank" rel="noopener">.attr()</a></li>
</ul>
<p><img src="https://i.imgur.com/OqjHMda.png" alt=""></p>
<ul>
<li><code>listItems.push(listItem);</code>將列表項目，放入空陣列中</li>
</ul>
<pre><code class="javascript">//Fisher-Yates洗牌演算法
function fisherYatesShuffle(arr) {
  for (var i = arr.length - 1; i &gt; 0; i--) {
    var j = Math.floor(Math.random() * (i + 1)); //random index
    [arr[i], arr[j]] = [arr[j], arr[i]]; // swap
  }
}
/製作實際可以看到的list
function creatList() {
  let placeArr = [...bestPlace];
  fisherYatesShuffle(placeArr);
  $.each(placeArr, function (index, place) {
    const listItem = $(&#39;&lt;li&gt;&lt;/li&gt;&#39;).appendTo(&#39;#draggable-list&#39;);
    // console.log(listItem);
    listItem.attr(&quot;data-index&quot;, index);
    //listItem.addClass(&#39;wrong&#39;)
    listItem.html(`&lt;span class=&quot;number&quot;&gt;${index + 1}&lt;/span&gt;
        &lt;div class=&quot;draggable&quot; draggable=&quot;true&quot;&gt;
          &lt;p class=&quot;place-name&quot;&gt;${place}&lt;/p&gt;
          &lt;i class=&quot;fas fa-grip-lines&quot;&gt;&lt;/i&gt;
        &lt;/div&gt;`)


    listItems.push(listItem);
    //insert into dom
    $(&#39;#draggable-list&#39;).append(listItem);
  });

  addEventListeners()
}</code></pre>
<p>參考資料：<br>push：<br><a href="https://ithelp.ithome.com.tw/articles/10222922" target="_blank" rel="noopener">JS 從陣列 Array 尾端新增元素的 push()</a><br><a href="https://www.oxxostudio.tw/articles/201908/js-array.html" target="_blank" rel="noopener">JavaScript Array 陣列操作方法大全 ( 含 ES6 )</a></p>
<h3 id="3-拖曳的監聽事件"><a href="#3-拖曳的監聽事件" class="headerlink" title="3.拖曳的監聽事件"></a>3.拖曳的監聽事件</h3><ul>
<li>拖曳開始的監聽，元素是抓取<code>draggables</code>，後續的drop、dragenter、dragover等事件，元素是<code>.draggable-list li</code></li>
<li>針對要被拖曳的元素（dragSource）監聽事件</li>
<li>利用forEach方式，允許多個可拖曳的物件</li>
</ul>
<ul>
<li>抓取的元素：<br><img src="https://i.imgur.com/5G60Pmr.png" alt=""><br><img src="https://i.imgur.com/zXR4YWT.png" alt=""></li>
</ul>
<pre><code class="javascript">//監聽事件
function addEventListeners() {
  const draggables = document.querySelectorAll(&#39;.draggable&#39;);
  const dragListItems = document.querySelectorAll(&#39;.draggable-list li&#39;);

  //Dragable dot 增加監聽事件

  draggables.forEach(draggable =&gt; {
    draggable.addEventListener(&#39;dragstart&#39;, dragStart);
  });
  dragListItems.forEach(item =&gt; {
    item.addEventListener(&#39;dragover&#39;, dragOver);
    item.addEventListener(&#39;drop&#39;, dragDrop);
    item.addEventListener(&#39;dragenter&#39;, dragEnter);
    item.addEventListener(&#39;dragleave&#39;, dragLeave);
  });

}</code></pre>
<p><a href="https://pjchender.blogspot.com/2017/08/html5-drag-and-drop-api.html" target="_blank" rel="noopener">[筆記] 製作可拖曳的元素（HTML5 Drag and Drop API）</a></p>
<h3 id="4-針對監聽事件，設置各執行的函式"><a href="#4-針對監聽事件，設置各執行的函式" class="headerlink" title="4.針對監聽事件，設置各執行的函式"></a>4.針對監聽事件，設置各執行的函式</h3><ul>
<li>為了能夠追蹤抓取項目，所以一開始先宣告一個索引變數。</li>
<li><code>dragStart()</code>:宣告<code>dragStartIndex</code>變數為抓取到的<code>li</code>-&gt;<code>data-index</code></li>
</ul>
<p><img src="https://i.imgur.com/6tMHuYr.png" alt=""></p>
<ul>
<li>有拖曳的開始，就會有結束，也就是放置(<code>dragDrop()</code>)：<code>dragEndIndex</code>同樣也是以索引來作為依據，並在設置一個交換的函式</li>
</ul>
<pre><code class="javascript">//要能夠持續追蹤每個項目的index，所以要有個初始變數
let dragStartIndex;
//拖拉的各函式

function dragStart() {
  //console.log(&#39;Event: &#39;, &#39;dragstart&#39;);
  dragStartIndex = +$(this).closest(&#39;li&#39;).attr(&#39;data-index&#39;);

  console.log(dragStartIndex);
};
function dragOver(e) {
  // console.log(&#39;Event: &#39;, &#39;dragover&#39;);
  e.preventDefault();
}
//設定開始的index,以及結束的index是為了交換
function dragDrop() {
  // console.log(&#39;Event: &#39;, &#39;dragdrop&#39;);
  const dragEndIndex = +$(this).attr(&#39;data-index&#39;);
  swapItems(dragStartIndex, dragEndIndex);
  $(this).removeClass(&#39;over&#39;);
}
</code></pre>
<h3 id="5-交換索引，使物件交換位置swapItems"><a href="#5-交換索引，使物件交換位置swapItems" class="headerlink" title="5.交換索引，使物件交換位置swapItems"></a>5.交換索引，使物件交換位置<code>swapItems</code></h3><ul>
<li>透過抓取到的開始與結束的索引，來填入要交換的變數</li>
</ul>
<pre><code class="javascript">function swapItems(fromIndex, toIndex) {
  //要設定交換之前，要先到dragover去設定e.preventDefault();（因為dragover會擋到交換的執行）

  const itemOne = listItems[fromIndex].find(&#39;.draggable&#39;);
  const itemTwo = listItems[toIndex].find(&#39;.draggable&#39;);

  //console.log(itemOne, itemTwo)
  listItems[fromIndex].append(itemTwo);
  listItems[toIndex].append(itemOne);
}</code></pre>
<h3 id="6-延續拖曳監聽事件，所要執行的其他函式"><a href="#6-延續拖曳監聽事件，所要執行的其他函式" class="headerlink" title="6.延續拖曳監聽事件，所要執行的其他函式"></a>6.延續拖曳監聽事件，所要執行的其他函式</h3><ul>
<li><p><code>dragEnter()</code>拖曳元素進入要放置的目標位置，所觸發的事件。在此是設定要放入目標位置時，增加一個<code>class</code>的效果</p>
</li>
<li><p>進入目標位置，其相互搭配的事件就是離開<code>dragLeave()</code>，當拖曳元素離開放置位置時，所發生的事件。在此為設定，去除於原本<code>class</code>的效果。</p>
</li>
</ul>
<pre><code class="javascript">function dragEnter() {
  // console.log(&#39;Event: &#39;, &#39;dragenter&#39;);
  $(this).addClass(&#39;over&#39;);
}
function dragLeave() {
  // console.log(&#39;Event: &#39;, &#39;dragleave&#39;);
  $(this).removeClass(&#39;over&#39;);
}
</code></pre>
<h3 id="7-核對順序"><a href="#7-核對順序" class="headerlink" title="7.核對順序"></a>7.核對順序</h3><ul>
<li>抓取listItems，來跑forEach，其要參照的參數是，項目、索引。</li>
<li>宣告<code>placeName</code>為參數<code>listItem</code>，draggable的文字字串。<ul>
<li>trim()用來去除字串前後的空白</li>
</ul>
</li>
<li>判斷句<code>placeName !== bestPlace[index]</code></li>
<li><code>console.log(bestPlace[index])</code>會印出，正確的順序。</li>
</ul>
<p><img src="https://i.imgur.com/xIR3X98.png" alt=""></p>
<ul>
<li><p>核對結果：就是分別加入<code>wrong</code>、<code>&#39;right&#39;</code>。</p>
<pre><code class="javascript">//核對排名順序
function checkOrder() {
listItems.forEach((listItem, index) =&gt; {
  const placeName = listItem.find(&#39;.draggable&#39;).text().trim();

  if (placeName !== bestPlace[index]) {
    listItem.addClass(&#39;wrong&#39;);
  } else {
    listItem.removeClass(&#39;wrong&#39;);
    listItem.addClass(&#39;right&#39;);
  }
});
}</code></pre>
</li>
</ul>
<hr>
<h2 id="以下為補充資料："><a href="#以下為補充資料：" class="headerlink" title="以下為補充資料："></a>以下為補充資料：</h2><h3 id="拖曳補充資料："><a href="#拖曳補充資料：" class="headerlink" title="拖曳補充資料："></a>拖曳補充資料：</h3><p><a href="https://ourcodeworld.com/articles/read/664/top-5-best-sortable-and-draggable-list-javascript-and-jquery-plugins" target="_blank" rel="noopener">Top 5: Best Sortable &amp; Draggable List JavaScript and jQuery Plugins</a><br><a href="https://ithelp.ithome.com.tw/articles/10120587" target="_blank" rel="noopener">實用網頁工具庫 - jQuery UI (上) 元件篇
</a></p>
<h3 id="使陣列隨機排序"><a href="#使陣列隨機排序" class="headerlink" title="使陣列隨機排序"></a>使陣列隨機排序</h3><ul>
<li><p>使用<code>map</code>將陣列轉換為新陣列，創造vale、以及加上sort排序值(利用<code>Math.random()</code>來產生亂數)</p>
</li>
<li><p>使用sort隨機排序，剛剛的sort值是隨機產生，再一次使用sort，來使排的順序也隨機。</p>
</li>
<li><p>最後，因為排序後陣列中的物件是<code>{ value: , sort:  }</code>，而我們要讓畫面只顯示<code>value:</code>，所以再使用<code>map</code>將新陣列轉回只有該資料的陣列。</p>
<pre><code class="javascript">function createList() {
[...richestPeople]
  .map(a =&gt; ({ value: a, sort: Math.random() }))
  .sort((a, b) =&gt; a.sort - b.sort)
  .map(a =&gt; a.value)
  .forEach((person, index) =&gt; {
    const listItem = document.createElement(&#39;li&#39;);

    listItem.setAttribute(&#39;data-index&#39;, index);

    listItem.innerHTML = `
      &lt;span class=&quot;number&quot;&gt;${index + 1}&lt;/span&gt;
      &lt;div class=&quot;draggable&quot; draggable=&quot;true&quot;&gt;
        &lt;p class=&quot;person-name&quot;&gt;${person}&lt;/p&gt;
        &lt;i class=&quot;fas fa-grip-lines&quot;&gt;&lt;/i&gt;
      &lt;/div&gt;
    `;

    listItems.push(listItem);

    draggable_list.appendChild(listItem);
  });

addEventListeners();
}</code></pre>
<p><a href="https://shubo.io/javascript-random-shuffle/" target="_blank" rel="noopener">[筆記] 如何正確實作 JavaScript Array Random Shuffle 亂數排序演算法</a><br><a href="https://www.delftstack.com/zh-tw/howto/javascript/shuffle-array-javascript/" target="_blank" rel="noopener">在 JavaScript 中對一個陣列進行隨機化或洗牌
</a></p>
</li>
</ul>
<hr>
<h3 id="jquery-ui"><a href="#jquery-ui" class="headerlink" title="jquery ui"></a>jquery ui</h3><pre><code class="javascript">//https://stackoverflow.com/questions/6426795/what-is-disableselection-used-for-in-jquery-ui
function dragdrop() {
  $(&quot;#draggable-list&quot;).sortable({
    //connectWith: &quot;ul&quot;,
    delay: 300,
    distance: 15,
    //number: &quot;span:not(.number)&quot;,
    iframeFix: true,

  }).disableSelection();

}</code></pre>
<hr>
<h3 id="顏色"><a href="#顏色" class="headerlink" title="顏色"></a>顏色</h3><p><a href="https://www.0to255.com/f2e8cf" target="_blank" rel="noopener">0-255</a><br><a href="https://webgradients.com/" target="_blank" rel="noopener">漸層顏色</a><br><a href="https://coolors.co/palettes/trending" target="_blank" rel="noopener">colors</a><br><a href="https://stackoverflow.com/questions/34494873/why-is-my-jquery-selector-returning-a-n-fn-init0-and-what-is-it" target="_blank" rel="noopener">Why is my JQuery selector returning a n.fn.init[0], and what is it?</a></p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2021/01/15/js-DOMArrayMethods/" title="JS實作- DOM Array Methods"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: JS實作- DOM Array Methods</span></a><a class="button is-default" href="/2021/01/15/js-musicPlayer/" title="JS實作- musicPlayer"><span class="has-text-weight-semibold">Next: JS實作- musicPlayer</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/https://github.com/Eva813"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Eva 2022</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>