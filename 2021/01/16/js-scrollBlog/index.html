<!DOCTYPE html><html class="appearance-auto" lang="en"><head><meta charset="UTF-8"><title>JS實作- scrollBlog</title><meta name="description" content="Front-end Engineer"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="成品
觀察功能需求1.隨著頁面的往下捲動，會載入新的資料

一開始頁面載入，會呈現5筆資料，捲動往下，會再載入5筆
使用{JSON} Placeholder的資料來串接(運用ajax)
設定捲動位置，並於該位置時，會呈現載入的圖示
setTimeout來呈現載入的時間與畫面

2.網頁的各資料是有順序，資料左上會有編碼

利用資料本身的id作為序號
於js時，帶入該變數取值

css部分1.製作左上方，數字
利用position: absolute;定位位置，並利用並利用top、left調整位置
使用display: flex;調整數字的位置，align-items: center;
justify-content: center;使水平、垂直置中.post .number {
position: abso.."><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Let's Code" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Eva's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">JS實作- scrollBlog</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Click back to the top</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">Home</a></h3><h3 class="is-inline-block"><a href="/archives">Archives</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#觀察功能需求"><span class="toc-text">觀察功能需求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#css部分"><span class="toc-text">css部分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-製作左上方，數字"><span class="toc-text">1.製作左上方，數字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-載入畫面的原點圖示"><span class="toc-text">2.載入畫面的原點圖示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用jQuery創造div"><span class="toc-text">使用jQuery創造div</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#each"><span class="toc-text">each()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Infinite-Scroll無限捲動-瀑布流"><span class="toc-text">3.Infinite Scroll無限捲動(瀑布流)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#注意：window本身沒有scrollTop-Left這個屬性，所以window-scrollTop是undefined的"><span class="toc-text">注意：window本身沒有scrollTop&#x2F;Left這個屬性，所以window.scrollTop是undefined的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#本段落語法："><span class="toc-text">本段落語法：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-篩選輸入框資料"><span class="toc-text">4.篩選輸入框資料</span></a></li></ol></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/JS"><i class="tag post-item-tag">JS</i></a><a href="/tags/ajax%20"><i class="tag post-item-tag">ajax </i></a><a href="/tags/setTimeout"><i class="tag post-item-tag">setTimeout</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">JS實作- scrollBlog</h1><time class="has-text-grey" datetime="2021-01-16T01:03:51.000Z">2021-01-16</time><article class="mt-2 post-content"><p><a href="https://eva813.github.io/Eva_portfolio/scrollBlog/scrollBlog.html" target="_blank" rel="noopener">成品</a></p>
<h2 id="觀察功能需求"><a href="#觀察功能需求" class="headerlink" title="觀察功能需求"></a>觀察功能需求</h2><p>1.隨著頁面的往下捲動，會載入新的資料</p>
<ul>
<li>一開始頁面載入，會呈現5筆資料，捲動往下，會再載入5筆</li>
<li>使用<a href="https://jsonplaceholder.typicode.com/" target="_blank" rel="noopener">{JSON} Placeholder</a>的資料來串接(運用ajax)</li>
<li>設定捲動位置，並於該位置時，會呈現載入的圖示</li>
<li>setTimeout來呈現載入的時間與畫面</li>
</ul>
<p>2.網頁的各資料是有順序，資料左上會有編碼</p>
<ul>
<li>利用資料本身的id作為序號</li>
<li>於js時，帶入該變數取值</li>
</ul>
<h2 id="css部分"><a href="#css部分" class="headerlink" title="css部分"></a>css部分</h2><h3 id="1-製作左上方，數字"><a href="#1-製作左上方，數字" class="headerlink" title="1.製作左上方，數字"></a>1.製作左上方，數字</h3><ul>
<li>利用<code>position: absolute;</code>定位位置，並利用並利用<code>top</code>、<code>left</code>調整位置</li>
<li>使用<code>display: flex;</code>調整數字的位置，<code>align-items: center;
justify-content: center;</code>使水平、垂直置中<pre><code class="css">.post .number {
position: absolute;
top: -15px;
left: -15px;
font-size: 15px;
width: 40px;
height: 40px;
border-radius: 50%;
background: #fff;
color: #296ca8;
display: flex;
align-items: center;
justify-content: center;
padding: 7px 10px;
}</code></pre>
<img src="https://i.imgur.com/FkIcque.png" alt=""></li>
</ul>
<h3 id="2-載入畫面的原點圖示"><a href="#2-載入畫面的原點圖示" class="headerlink" title="2.載入畫面的原點圖示"></a>2.載入畫面的原點圖示</h3><ul>
<li>先製作load的基本設定，如flex的排列、位置固定於下方，以及透明度的顯示</li>
<li>針對原點訂定背景、原點大小。新增動畫效果，<code>animation: bounce 0.5s ease-in infinite;</code></li>
<li>動畫名稱<code>@keyframes bounce</code>，設定在某時間點，<code>translateY</code>，的位置。</li>
<li>為了讓圓點的跳動時間不同，針對2、3的原點，設定延遲時間<code>animation-delay: 0.2s;</code><pre><code class="css">.loader {
/* opacity: 0; */
display: flex;
position: fixed; /*位置固定於最下面*/
bottom: 50px;
transition: opacity 0.3s ease-in;
}
</code></pre>
</li>
</ul>
<p>.loader.show {<br>  opacity: 1;<br>}</p>
<p>/<em>製作圓點</em>/</p>
<p>.circle {<br>  background-color: #fff;<br>  width: 10px;<br>  height: 10px;<br>  border-radius: 50%;<br>  margin: 5px;<br>  animation: bounce 0.5s ease-in infinite;<br>}</p>
<p>.circle:nth-of-type(2) {<br>  animation-delay: 0.1s;<br>}</p>
<p>.circle:nth-of-type(3) {<br>  animation-delay: 0.2s;<br>}</p>
<p>@keyframes bounce {<br>  0%,<br>  100% {<br>    transform: translateY(0);<br>  }</p>
<p>  50% {<br>    transform: translateY(-10px);<br>  }<br>}</p>
<pre><code>
![](https://i.imgur.com/RuhdRt7.gif)

## js部分
### 1.jsonplaceholder:

* 為取得資料的位置
* 抓取5筆的方式，後面參數的設定而來
https://jsonplaceholder.typicode.com/posts?_limit5



### 2.使用ajax串接API

* [Async/Await 非同步流程控制-筆記](https://hackmd.io/Ciayzu-vQcyrh-WeVNeOPQ?view)
* 參考[Using async await with jQuery&#39;s $.ajax](https://petetasker.com/using-async-await-jquerys-ajax)、[How to await the ajax request?](https://stackoverflow.com/questions/27612372/how-to-await-the-ajax-request)，使用jQuery&#39;s`$.ajax`執行async
* 在try裡面，放入一般`$.ajax`抓取API資料的方式，如url、type、dataType
* 首先，在連結的部分，我們希望每次抓取5筆資料，呈現1頁，所以在外面設置`let limit = 5;let page = 1`於url中加入該變數
* 在抓取資料成功時，放入function，並用`$.each`來執行
     * 在`$.each`先傳入該資料(data)陣列，其`function (index, value)`放入索引以及值的內容。
     * 宣告`postEl`變數，創造名為`post`的`div`=&gt; ``$(&#39;\&lt;div /&gt;&#39;)``
     * 加入`post`class
     * 加入html
     * 最後將此變數，放置呈現文章的容器`postEl.appendTo(&#39;#posts-container&#39;);`

```javascript
let limit = 5
let page = 1

async function doAjax() {
  let result;

  try {
    result = await $.ajax({
      url: `https://jsonplaceholder.typicode.com/posts?_limit=${limit}&amp;_page=${page}`,
      type: &#39;get&#39;,
      dataType: &#39;json&#39;,
      success: function (data) {

      $.each(data, function (index, value) {
          const postEl = $(&#39;&lt;div /&gt;&#39;).addClass(&#39;post&#39;).html(`&lt;div class=&quot;number&quot;&gt;${value.id}&lt;/div&gt; &lt;div class=&quot;post-info&quot;&gt;&lt;h2 class=&quot;post-title&quot;&gt;${value.title}&lt;/h2&gt;&lt;p class=&quot;post-body&quot;&gt;${value.body}&lt;/p&gt;
      &lt;/div&gt;`)
          //console.log(postEl)
          postEl.appendTo(&#39;#posts-container&#39;);
          //$(&#39;#posts-container&#39;).append(postEl)

        });


      }
    });

    return result;
  } catch (error) {
    console.error(error);
  }

}

doAjax();</code></pre><p>查看是否有成功取得資料：<code>console.log(data);</code><br><img src="https://i.imgur.com/wJPpdfh.png" alt=""></p>
<h3 id="使用jQuery創造div"><a href="#使用jQuery創造div" class="headerlink" title="使用jQuery創造div"></a>使用jQuery創造div</h3><p><a href="https://stackoverflow.com/questions/10402567/jquery-div-vs-div" target="_blank" rel="noopener">https://stackoverflow.com/questions/10402567/jquery-div-vs-div</a></p>
<h4 id="each"><a href="#each" class="headerlink" title="each()"></a><code>each()</code></h4><p><a href="https://api.jquery.com/jquery.each/" target="_blank" rel="noopener">jQuery.each()</a></p>
<h3 id="3-Infinite-Scroll無限捲動-瀑布流"><a href="#3-Infinite-Scroll無限捲動-瀑布流" class="headerlink" title="3.Infinite Scroll無限捲動(瀑布流)"></a>3.Infinite Scroll無限捲動(瀑布流)</h3><ul>
<li><code>scrollTop</code>網頁右邊的卷軸到最上端網頁的距離有多少</li>
<li><code>scrollHeight</code> 取得整個沒被擋住的高、<code>clientHeight</code> 取得元素的高度（含padding 不含 border）</li>
<li>完整內容高度 (scrollHeight) = 內容頂端與捲軸頂端的距離 (scrollTop) + 捲軸本身高度 (clientHeight) + 內容底端與捲軸底端的距離。</li>
</ul>
<p>例子:</p>
<pre><code class="javascript">$(function () {
  $(window).scroll(function () {
    var scrollVal = $(this).scrollTop();
    $(&quot;span.qScrollTop&quot;).text(scrollVal);
  });
});

if(scrollVal &gt; 500){
  /* 如果滾動的物件捲動 &gt; 500 則觸發指定的動作。*/
}
</code></pre>
<h4 id="注意：window本身沒有scrollTop-Left這個屬性，所以window-scrollTop是undefined的"><a href="#注意：window本身沒有scrollTop-Left這個屬性，所以window-scrollTop是undefined的" class="headerlink" title="注意：window本身沒有scrollTop/Left這個屬性，所以window.scrollTop是undefined的"></a>注意：window本身沒有scrollTop/Left這個屬性，所以window.scrollTop是undefined的</h4><p>所以可能要從body、document來取得</p>
<h4 id="本段落語法："><a href="#本段落語法：" class="headerlink" title="本段落語法："></a>本段落語法：</h4><ul>
<li>上述說明各視窗高度得解釋，在此if判斷式中<code>scrollTop + clientHeight &gt;= scrollHeight - 5</code>來計算，當捲軸捲到該位置時，要呈現載入畫面</li>
<li>接著根據載入畫面函式，來放入載入以及呈現接續畫面得設定<ul>
<li>使用<code>setTimeout()</code>，在1秒後消除載入圖示，接著在300毫秒後，馬上換頁執行載入新資料</li>
</ul>
</li>
</ul>
<pre><code class="javascript">$(window).scroll(function () {
  var scrollTop = $(this).scrollTop();
  var scrollHeight = $(&#39;body&#39;).prop(&quot;scrollHeight&quot;);
  //一樣 var scrollHeight2 = document.documentElement.scrollHeight;
  var clientHeight = document.documentElement.clientHeight;
  //https://stackoverflow.com/questions/10423759/plain-javascript-to-jquery-clientheight

  // console.log(&#39;scrollTop:&#39;, scrollTop);
  // console.log(&#39;scrollHeight:&#39;, scrollHeight);
  // console.log(&#39;clientHeight:&#39;, clientHeight);


  if (scrollTop + clientHeight &gt;= scrollHeight - 5) {
    //console.log(&#39;show up 123&#39;)
    showLoading();
  }
})


//顯示載入圖示，並取得更多串接資料
function showLoading() {
  $(&#39;.loader&#39;).addClass(&#39;show&#39;);


  setTimeout(function () {

    $(&#39;.loader&#39;).removeClass(&#39;show&#39;);
    setTimeout(function () {
      page++;
      doAjax();
    }, 300);

  }, 1000);  //1秒之後消失

}</code></pre>
<p>參考資料：<br><a href="https://pjchender.blogspot.com/2015/04/jquery.html" target="_blank" rel="noopener">[筆記] 計算網頁底部位置，當網頁達到底部時才產生效果─jQuery</a><br><a href="https://shubo.io/element-size-scrolling/#%E7%84%A1%E9%99%90%E6%8D%B2%E5%8B%95-infinite-scroll" target="_blank" rel="noopener">一次搞懂 clientHeight/scrollHeight/scrollTop的區別</a><br><a href="https://kuro.tw/posts/2019/02/23/%E8%AB%87%E8%AB%87-JavaScript-%E7%9A%84-setTimeout-%E8%88%87-setInterval/" target="_blank" rel="noopener">談談 JavaScript 的 setTimeout 與 setInterval</a></p>
<h3 id="4-篩選輸入框資料"><a href="#4-篩選輸入框資料" class="headerlink" title="4.篩選輸入框資料"></a>4.篩選輸入框資料</h3><ul>
<li>綁定事件為<code>.keyup</code>指放開鍵盤的那個剎那，觸發該事件</li>
<li>執行的函式內容為：<ul>
<li><code>var text</code>取得輸入值並轉為小寫</li>
<li>利用迴圈，去搜尋關鍵字，判斷，值轉為小寫文字的內容是否符合條件</li>
<li>-1 ：意指條件不符合</li>
<li><code>indexOf()</code> 方法用來判斷字串字串變數中是否包含某字串。</li>
</ul>
</li>
</ul>
<pre><code class="javascript">//輸入框搜尋//https://makitweb.com/jquery-search-text-in-the-element-with-contains-selector/  (=&gt;Loop all .content )
  $(&#39;#filter&#39;).keyup(function () {

    // Search text
    var text = $(&#39;#filter&#39;).val().toLowerCase();

    // Hide all content class element
    $(&#39;.post&#39;).hide();

    // Search 
    $(&#39;.post&#39;).each(function () {

      if ($(this).text().toLowerCase().indexOf(&quot;&quot; + text + &quot;&quot;) != -1) {
        $(this).closest(&#39;.post&#39;).show();
      }
    });</code></pre>
<p>參考資料：<br><a href="https://medium.com/@yitailin/%E6%AF%94%E8%BC%83-keydown-keypress-keyup-%E7%9A%84%E5%B7%AE%E7%95%B0-4e873ba17e81" target="_blank" rel="noopener">比較 keydown, keypress, keyup 的差異</a><br><a href="https://makitweb.com/jquery-search-text-in-the-element-with-contains-selector/" target="_blank" rel="noopener">jQuery – Search text in the Element with :contains() Selector</a><br><a href="https://www.fooish.com/javascript/string/indexOf.html" target="_blank" rel="noopener">JavaScript String indexOf()</a></p>
<hr>
<p>補充參考：<br><a href="https://whien.medium.com/js20min-day-20-ajax-%E9%9D%9E%E5%90%8C%E6%AD%A5%E8%99%95%E7%90%86-asynchronous-javascript-and-xml-e74a059ab639" target="_blank" rel="noopener">JS20min Day — 20 AJAX 非同步處理 (Asynchronous JavaScript and XML)</a><br><a href="https://www.youtube.com/watch?v=NOprCnnjHm0" target="_blank" rel="noopener">回呼函式 Callbacks、Promises 物件、Async/Await 非同步流程控制 - 彭彭直播 at 2019/04/07</a></p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2021/01/16/js-countDown/" title="JS實作- 新年倒數"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">Previous: JS實作- 新年倒數</span></a><a class="button is-default" href="/2021/01/15/js-DOMArrayMethods/" title="JS實作- DOM Array Methods"><span class="has-text-weight-semibold">Next: JS實作- DOM Array Methods</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="Haojen/Claudia-theme-blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/https://github.com/Eva813"><i class="iconfont icon-github"></i></a><!-- Ins--><!-- RSS--><!-- 知乎--><!-- 领英--><!-- 脸书--></section><p><span>Copyright ©</span><span> Eva 2022</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/post.js"></script></body></html>